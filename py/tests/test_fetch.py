# import requests for the purposes of monkeypatching
import requests

import lounaat_info.fetch as subject

# custom class to be the mock return value
# will override the requests.Response returned from requests.get
class MockResponse:
    # NOTE: that this is a cut down response to make writing tests easier
    # mock text attribute always returns a specific test string
    #text = '<div class="menu item category-0"><div class="item-header"><div class="icon"><a href="#4313" class="favorite dislike" title="lisää/poista suosikeista"></a></div> <h3><a href="/lounas/kainuun-portti/kajaani">Kainuun Portti</a></h3><div class="details"><ul class="review"><li class="current" style="width: 0%;">/5.0</li></ul><div class="icon-s"><a href="#4313" class="hide" title="älä näytä tätä ravintolaa enää"></a></div><p class="lunch closed">ei lounasta</p></div></div><div class="item-body"><ul><li class="menu-item"><p class="info">Ei lounasta sunnuntaina</p></li></ul></div><div class="item-footer"><p class="dist" title="Mainuantie 350, 87700 Kajaani"><i class="fa fa-map-marker"></i> 0m</p></div></div><div class="menu item category-1"><div class="item-header"><div class="icon"><a href="#3889" class="favorite dislike" title="lisää/poista suosikeista"></a></div> <h3><a href="/lounas/amica-atima/kajaani">Amica Atima</a></h3><div class="details"><ul class="review"><li class="current" style="width: 0%;">/5.0</li></ul><div class="icon-s"><a href="#3889" class="hide" title="älä näytä tätä ravintolaa enää"></a></div><p class="lunch closed">ei lounasta</p></div></div><div class="item-body"><ul><li class="menu-item"><p class="info">Ei lounasta sunnuntaina</p></li></ul></div><div class="item-footer"><p class="dist" title="Lönnrotinkatu 2 B, 87100 Kajaani"><i class="fa fa-map-marker"></i> 180m</p></div></div><div class="menu item category-0"><div class="item-header"><div class="icon"><a href="#4516" class="favorite dislike" title="lisää/poista suosikeista"></a></div> <h3><a href="/lounas/pancho-villa-kajaani/kajaani">Pancho Villa Kajaani</a></h3><div class="details"><ul class="review"><li class="current" style="width: 0%;">/5.0</li></ul><div class="icon-s"><a href="#4516" class="hide" title="älä näytä tätä ravintolaa enää"></a></div><p class="lunch closed">ei lounasta</p></div></div><div class="item-body"><ul><li class="menu-item"><p class="info">Ei lounasta sunnuntaina</p></li></ul></div><div class="item-footer"><p class="dist" title="Lönnrotinkatu 1, 87100 Kajaani"><i class="fa fa-map-marker"></i> 260m</p></div></div><div class="menu item new category-0"><div class="item-header"><div class="adtext">Uusi ravintola</div><div class="icon"><a href="#4708" class="favorite dislike" title="lisää/poista suosikeista"></a></div> <h3><a href="/lounas/lori/kajaani">Lori</a></h3><div class="details"><ul class="review"><li class="current" style="width: 0%;">/5.0</li></ul><div class="icon-s"><a href="#4708" class="hide" title="älä näytä tätä ravintolaa enää"></a></div><p class="lunch closed">ei lounasta</p></div></div><div class="item-body"><ul><li class="menu-item"><p class="info">Ei lounasta sunnuntaina</p></li></ul></div><div class="item-footer"><p class="dist" title="Kauppakatu 10, 87100 Kajaani"><i class="fa fa-map-marker"></i> 390m</p></div></div><div class="menu item category-0"><div class="item-header"><div class="icon"><a href="#3711" class="favorite dislike" title="lisää/poista suosikeista"></a></div></div>'
    text = '<div class="menu item category-0"><div class="item-header"><div class="icon"><a href="#4313" class="favorite dislike" title="lisää/poista suosikeista"></a></div> <h3><a href="/lounas/kainuun-portti/kajaani">Kainuun Portti</a></h3><div class="details"><ul class="review"><li class="current" style="width: 0%;">/5.0</li></ul><div class="icon-s"><a href="#4313" class="hide" title="älä näytä tätä ravintolaa enää"></a></div><p class="lunch closed"><i class="fa fa-clock-o"></i> 10:30-14:30</p></div></div><div class="item-body"><ul><li class="menu-item item-diet-l item-diet-g"><p class="dish">Hernekeittoa   <a href="#g" title="Gluteeniton" class="diet diet-g">g </a>     <a href="#l" title="Laktoositon" class="diet diet-l">l  </a> </p></li><li class="menu-item item-diet-l item-diet-g"><p class="dish">Sipuliset pannupihvit   <a href="#g" title="Gluteeniton" class="diet diet-g">g </a>     <a href="#l" title="Laktoositon" class="diet diet-l">l  </a> </p></li><li class="menu-item"><p class="dish">Muusia & pannukakkua</p></li></ul></div><div class="item-footer"><p class="dist" title="Mainuantie 350, 87700 Kajaani"><i class="fa fa-map-marker"></i> 0m</p></div></div><div class="menu item category-1"><div class="item-header"><div class="icon"><a href="#3889" class="favorite dislike" title="lisää/poista suosikeista"></a></div> <h3><a href="/lounas/amica-atima/kajaani">Amica Atima</a></h3><div class="details"><ul class="review"><li class="current" style="width: 0%;">/5.0</li></ul><div class="icon-s"><a href="#3889" class="hide" title="älä näytä tätä ravintolaa enää"></a></div><p class="lunch closed"><i class="fa fa-clock-o"></i> 10:30-13</p></div></div><div class="item-body"><ul><li><a class="missing" target="_blank" href="https://www.amica.fi/ravintolat/ravintolat-kaupungeittain/kajaani/atima/">Katso päivän lounaslista ravintolan sivuilta!</a></li></ul></div><div class="item-footer"><p class="dist" title="Lönnrotinkatu 2 B, 87100 Kajaani"><i class="fa fa-map-marker"></i> 180m</p></div></div><div class="menu item category-0"><div class="item-header"><div class="icon"><a href="#4516" class="favorite dislike" title="lisää/poista suosikeista"></a></div> <h3><a href="/lounas/pancho-villa-kajaani/kajaani">Pancho Villa Kajaani</a></h3><div class="details"><ul class="review"><li class="current" style="width: 0%;">/5.0</li></ul><div class="icon-s"><a href="#4516" class="hide" title="älä näytä tätä ravintolaa enää"></a></div><p class="lunch closed"><i class="fa fa-clock-o"></i> 10:30-14</p></div></div><div class="item-body"><ul><li><a class="missing" target="_blank" href="http://panchovilla.fi/ravintolat/kajaani">Katso päivän lounaslista ravintolan sivuilta!</a></li></ul></div><div class="item-footer"><p class="dist" title="Lönnrotinkatu 1, 87100 Kajaani"><i class="fa fa-map-marker"></i> 260m</p></div></div><div class="menu item new category-0"><div class="item-header"><div class="adtext">Uusi ravintola</div><div class="icon"><a href="#4708" class="favorite dislike" title="lisää/poista suosikeista"></a></div> <h3><a href="/lounas/lori/kajaani">Lori</a></h3><div class="details"><ul class="review"><li class="current" style="width: 0%;">/5.0</li></ul><div class="icon-s"><a href="#4708" class="hide" title="älä näytä tätä ravintolaa enää"></a></div><p class="lunch closed"><i class="fa fa-clock-o"></i> 11-15</p></div></div><div class="item-body"><ul><li><a class="missing" target="_blank" href="https://www.facebook.com/Ravintola-Lori-294714674680644/">Katso päivän lounaslista ravintolan sivuilta!</a></li></ul></div><div class="item-footer"><p class="dist" title="Kauppakatu 10, 87100 Kajaani"><i class="fa fa-map-marker"></i> 390m</p></div></div>'


def test_res_text(monkeypatch):

    # Any arguments may be passed and mock_get() will always return our
    # mocked object, which only has the .json() method.
    def mock_get(*args, **kwargs):
        return MockResponse()

    # apply the monkeypatch for requests.get to mock_get
    monkeypatch.setattr(requests, "get", mock_get)

    # app.get_json, which contains requests.get, uses the monkeypatch
    res = subject.fetch_lunch_data(day=0, lat=0, lon=0)
    res_text = res.text
    assert res_text != None
    assert res_text != ""